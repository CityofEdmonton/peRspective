<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interface to the Perspective API • peRspective</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interface to the Perspective API">
<meta property="og:description" content="Provides access to the Perspective API.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">peRspective</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/favstats/peRspective">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- [![Travis build status](https://travis-ci.org/favstats/peRspective.svg?branch=master)](https://travis-ci.org/favstats/peRspective) -->
<div id="perspective" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#perspective" class="anchor"></a>peRspective <img src="images/perspective2.png" width="160px" align="right">
</h1></div>

<p>Perspective is an API that uses machine learning models to score the perceived impact a comment might have on a conversation. <a href="http://www.perspectiveapi.com/">Website</a>.</p>
<p><code>peRspective</code> provides access to the API using the R programming language.</p>
<p>For an excellent documentation of the Perspective API see <a href="https://github.com/conversationai/perspectiveapi/blob/master/api_reference.md">here</a>.</p>
<div id="readme-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#readme-overview" class="anchor"></a>README Overview</h2>
<ul>
<li><a href="https://github.com/favstats/peRspective#setup">Setup</a></li>
<li><a href="https://github.com/favstats/peRspective#models">Models</a></li>
<li>
<a href="https://github.com/favstats/peRspective#usage">Usage</a>
<ul>
<li><a href="https://github.com/favstats/peRspective#prsp_score"><code>prsp_score</code></a></li>
<li><a href="https://github.com/favstats/peRspective#prsp_stream"><code>prsp_stream</code></a></li>
</ul>
</li>
</ul>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<div id="get-an-api-key" class="section level3">
<h3 class="hasAnchor">
<a href="#get-an-api-key" class="anchor"></a>Get an API key</h3>
<ol style="list-style-type: decimal">
<li>Create a Google Cloud project in your <a href="https://console.developers.google.com/">Google Cloud console</a>
</li>
<li>Go to <a href="https://console.developers.google.com/apis/api/commentanalyzer.googleapis.com/overview">Perspective API’s overview page</a> and click <strong>Enable</strong>
</li>
<li>Go to the <a href="https://console.developers.google.com/apis/credentials">API credentials page</a>, just click <strong>Create credentials</strong>, and choose “API Key”.</li>
</ol>
<p>Now you are ready to make a request to the Perspective API!</p>
</div>
<div id="quota-and-character-length-limits" class="section level3">
<h3 class="hasAnchor">
<a href="#quota-and-character-length-limits" class="anchor"></a>Quota and character length Limits</h3>
<p>Be sure to check your quota limit! You can learn more about Perspective API quota limit by visiting <a href="https://console.cloud.google.com/apis/api/commentanalyzer.googleapis.com/quotas">your google cloud project’s Perspective API page</a>.</p>
<p>The maximum text size per request is 3000 bytes.</p>
</div>
</div>
<div id="models" class="section level2">
<h2 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h2>
<p>For detailed overview of the used models <a href="https://github.com/conversationai/perspectiveapi/blob/master/api_reference.md">see here</a>.</p>
<p>Here is a list of models currently supported by <code>peRspective</code>:</p>
<table class="table table">
<thead><tr class="header">
<th align="left">Model Attribute Name</th>
<th align="left">Version</th>
<th align="left">Supported Languages</th>
<th align="left">Short Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">TOXICITY</td>
<td align="left">Alpha</td>
<td align="left">en, es, fr*, de*</td>
<td align="left">rude, disrespectful, or unreasonable comment that is likely to make people leave a discussion.</td>
</tr>
<tr class="even">
<td align="left">SEVERE_TOXICITY</td>
<td align="left">Alpha</td>
<td align="left">en, es, fr*, de*</td>
<td align="left">Same deep-CNN algorithm as TOXICITY, but is trained on ‘very toxic’ labels.</td>
</tr>
<tr class="odd">
<td align="left">IDENTITY_ATTACK</td>
<td align="left">Experimental toxicity sub-attribute</td>
<td align="left">en, fr*, de*, es*</td>
<td align="left">negative or hateful comments targeting someone because of their identity.</td>
</tr>
<tr class="even">
<td align="left">INSULT</td>
<td align="left">Experimental toxicity sub-attribute</td>
<td align="left">en, fr*, de*, es*</td>
<td align="left">insulting, inflammatory, or negative comment towards a person or a group of people.</td>
</tr>
<tr class="odd">
<td align="left">PROFANITY</td>
<td align="left">Experimental toxicity sub-attribute</td>
<td align="left">en, fr*, de*, es*</td>
<td align="left">swear words, curse words, or other obscene or profane language.</td>
</tr>
<tr class="even">
<td align="left">SEXUALLY_EXPLICIT</td>
<td align="left">Experimental toxicity sub-attribute</td>
<td align="left">en, fr*, de*, es*</td>
<td align="left">contains references to sexual acts, body parts, or other lewd content.</td>
</tr>
<tr class="odd">
<td align="left">THREAT</td>
<td align="left">Experimental toxicity sub-attribute</td>
<td align="left">en, fr*, de*, es*</td>
<td align="left">describes an intention to inflict pain, injury, or violence against an individual or group.</td>
</tr>
<tr class="even">
<td align="left">FLIRTATION</td>
<td align="left">Experimental toxicity sub-attribute</td>
<td align="left">en, fr*, de*, es*</td>
<td align="left">pickup lines, complimenting appearance, subtle sexual innuendos, etc.</td>
</tr>
<tr class="odd">
<td align="left">ATTACK_ON_AUTHOR</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Attack on the author of an article or post.</td>
</tr>
<tr class="even">
<td align="left">ATTACK_ON_COMMENTER</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Attack on fellow commenter.</td>
</tr>
<tr class="odd">
<td align="left">INCOHERENT</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Difficult to understand, nonsensical.</td>
</tr>
<tr class="even">
<td align="left">INFLAMMATORY</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Intending to provoke or inflame.</td>
</tr>
<tr class="odd">
<td align="left">LIKELY_TO_REJECT</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Overall measure of the likelihood for the comment to be rejected according to the NYT’s moderation.</td>
</tr>
<tr class="even">
<td align="left">OBSCENE</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Obscene or vulgar language such as cursing.</td>
</tr>
<tr class="odd">
<td align="left">SPAM</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Irrelevant and unsolicited commercial content.</td>
</tr>
<tr class="even">
<td align="left">UNSUBSTANTIAL</td>
<td align="left">NYT moderation models</td>
<td align="left">en</td>
<td align="left">Trivial or short comments.</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Languages that are annotated with "*" are only accessible in the <code>_EXPERIMENTAL</code> version of the models. In order to access them just add to the supplied model string like this: <code>TOXICITY_EXPERIMENTAL</code>.</p>
<p>A character vector that includes all supported models can be obtained like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb1-2" title="2">  peRspective<span class="op">::</span>prsp_models,</a>
<a class="sourceLine" id="cb1-3" title="3">  peRspective<span class="op">::</span>prsp_exp_models</a>
<a class="sourceLine" id="cb1-4" title="4">)</a></code></pre></div>
<pre><code>##  [1] "TOXICITY"                     "SEVERE_TOXICITY"             
##  [3] "IDENTITY_ATTACK"              "INSULT"                      
##  [5] "PROFANITY"                    "SEXUALLY_EXPLICIT"           
##  [7] "THREAT"                       "FLIRTATION"                  
##  [9] "ATTACK_ON_AUTHOR"             "ATTACK_ON_COMMENTER"         
## [11] "INCOHERENT"                   "INFLAMMATORY"                
## [13] "LIKELY_TO_REJECT"             "OBSCENE"                     
## [15] "SPAM"                         "UNSUBSTANTIAL"               
## [17] "TOXICITY_EXPERIMENTAL"        "SEVERE_TOXICITY_EXPERIMENTAL"
## [19] "IDENTITY_ATTACK_EXPERIMENTAL" "INSULT_EXPERIMENTAL"         
## [21] "PROFANITY_EXPERIMENTAL"       "THREAT_EXPERIMENTAL"</code></pre>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>First, install package from GitHub:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/reexports.html">install_github</a></span>(<span class="st">"favstats/peRspective"</span>)</a></code></pre></div>
<p>Load package:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(peRspective)</a></code></pre></div>
<p>Also the <code>tidyverse</code> for examples.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a></code></pre></div>
<p>Define your key variable.</p>
<p><code>peRspective</code> functions will read the API key from environment variable <code>perspective_api_key</code>. You can assign an environment object like this in your script:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span>(<span class="dt">perspective_api_key =</span> <span class="st">"YOUR_API_KEY"</span>)</a></code></pre></div>
<div id="prsp_score" class="section level3">
<h3 class="hasAnchor">
<a href="#prsp_score" class="anchor"></a><code>prsp_score</code>
</h3>
<p>Now you can use <code>prsp_score</code> to score your comments with various models provided by the Perspective API.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">my_text &lt;-<span class="st"> "You wrote this? Wow. This is dumb and childish, please go f**** yourself."</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">text_scores &lt;-<span class="st"> </span><span class="kw"><a href="reference/prsp_score.html">prsp_score</a></span>(</a>
<a class="sourceLine" id="cb7-4" title="4">           <span class="dt">text =</span> my_text, </a>
<a class="sourceLine" id="cb7-5" title="5">           <span class="dt">languages =</span> <span class="st">"en"</span>,</a>
<a class="sourceLine" id="cb7-6" title="6">           <span class="dt">score_model =</span> peRspective<span class="op">::</span>prsp_models</a>
<a class="sourceLine" id="cb7-7" title="7">           )</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9">text_scores <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">fct_reorder</span>(key, value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(key, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.5</span>, <span class="dt">linetype =</span> <span class="st">"dashed"</span>)</a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>A Trump Tweet:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">trump_tweet &lt;-<span class="st"> "The Fake News Media has NEVER been more Dishonest or Corrupt than it is right now. There has never been a time like this in American History. Very exciting but also, very sad! Fake News is the absolute Enemy of the People and our Country itself!"</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3">text_scores &lt;-<span class="st"> </span><span class="kw"><a href="reference/prsp_score.html">prsp_score</a></span>(</a>
<a class="sourceLine" id="cb8-4" title="4">           trump_tweet, </a>
<a class="sourceLine" id="cb8-5" title="5">           <span class="dt">score_sentences =</span> F,</a>
<a class="sourceLine" id="cb8-6" title="6">           <span class="dt">score_model =</span> peRspective<span class="op">::</span>prsp_models</a>
<a class="sourceLine" id="cb8-7" title="7">           )</a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9">text_scores <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">fct_reorder</span>(key, value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(key, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.5</span>, <span class="dt">linetype =</span> <span class="st">"dashed"</span>)</a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Instead of scoring just entire comments you can also score individual sentences with <code>score_sentences = T</code>. In this case the Perspective API will automatically split your text into reasonable sentences and score them in addition to an overall score.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">trump_tweet &lt;-<span class="st"> "The Fake News Media has NEVER been more Dishonest or Corrupt than it is right now. There has never been a time like this in American History. Very exciting but also, very sad! Fake News is the absolute Enemy of the People and our Country itself!"</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3">text_scores &lt;-<span class="st"> </span><span class="kw"><a href="reference/prsp_score.html">prsp_score</a></span>(</a>
<a class="sourceLine" id="cb9-4" title="4">           trump_tweet, </a>
<a class="sourceLine" id="cb9-5" title="5">           <span class="dt">score_sentences =</span> T,</a>
<a class="sourceLine" id="cb9-6" title="6">           <span class="dt">score_model =</span> peRspective<span class="op">::</span>prsp_models</a>
<a class="sourceLine" id="cb9-7" title="7">           )</a>
<a class="sourceLine" id="cb9-8" title="8"></a>
<a class="sourceLine" id="cb9-9" title="9">text_scores <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="st">  </span><span class="kw">unnest</span>(sentence_scores) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="st">  </span><span class="kw">select</span>(type, score, sentences) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="st">  </span><span class="kw">gather</span>(value, key, <span class="op">-</span>sentences, <span class="op">-</span>score) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">fct_reorder</span>(key, score)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(key, score)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>sentences, <span class="dt">ncol =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.5</span>, <span class="dt">linetype =</span> <span class="st">"dashed"</span>)</a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" width="1152"></p>
<p>You can also use Spanish (<code>es</code>) for <code>TOXICITY</code> and <code>SEVERE_TOXICITY</code> and <code>_EXPERIMENTAL</code>scoring.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">spanish_text &lt;-<span class="st"> "gastan en cosas que de nada sirven-nunca tratan de saber la verdad del funcionalismo de nuestro sistema solar y origen del cosmos-falso por Kepler. LAS UNIVERSIDADES DEL MUNDO NO SABEN ANALIZAR VERDAD O MENTIRA-LO QUE DICE KEPLER"</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">text_scores &lt;-<span class="st"> </span><span class="kw"><a href="reference/prsp_score.html">prsp_score</a></span>(</a>
<a class="sourceLine" id="cb10-5" title="5">           <span class="dt">text =</span> spanish_text, </a>
<a class="sourceLine" id="cb10-6" title="6">           <span class="dt">languages =</span> <span class="st">"es"</span>,</a>
<a class="sourceLine" id="cb10-7" title="7">           <span class="dt">key =</span> key,</a>
<a class="sourceLine" id="cb10-8" title="8">           <span class="dt">score_model =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOXICITY"</span>, <span class="st">"SEVERE_TOXICITY"</span>, <span class="st">"INSULT_EXPERIMENTAL"</span>)</a>
<a class="sourceLine" id="cb10-9" title="9">           )</a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11">text_scores <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="st">  </span><span class="kw">gather</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">fct_reorder</span>(key, value)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(key, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.5</span>, <span class="dt">linetype =</span> <span class="st">"dashed"</span>)</a></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div id="prsp_stream" class="section level3">
<h3 class="hasAnchor">
<a href="#prsp_stream" class="anchor"></a><code>prsp_stream</code>
</h3>
<p>So far we have only seen how to get individual comments or sentences scored. But what if you would like to run the function for an entire dataset full text? This is where <code>prsp_stream</code> comes in. At its core <code>prsp_stream</code> is a loop implemented within <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code> to iterate over your text column. To use it let’s first generate a mock tibble.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">text_sample &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb11-2" title="2">       <span class="dt">ctext =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"You wrote this? Wow. This is dumb and childish, please go f**** yourself."</span>,</a>
<a class="sourceLine" id="cb11-3" title="3">                 <span class="st">"I don't know what to say about this but it's not good. The commenter is just an idiot"</span>,</a>
<a class="sourceLine" id="cb11-4" title="4">                 <span class="st">"This goes even further!"</span>,</a>
<a class="sourceLine" id="cb11-5" title="5">                 <span class="st">"What the hell is going on?"</span>,</a>
<a class="sourceLine" id="cb11-6" title="6">                 <span class="st">"Please. I don't get it. Explain it again"</span>,</a>
<a class="sourceLine" id="cb11-7" title="7">                 <span class="st">"Annoying and irrelevant! I'd rather watch the paint drying on the wall!"</span>),</a>
<a class="sourceLine" id="cb11-8" title="8">       <span class="dt">textid =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#efdcxct"</span>, <span class="st">"#ehfcsct"</span>, </a>
<a class="sourceLine" id="cb11-9" title="9">                  <span class="st">"#ekacxwt"</span>,  <span class="st">"#ewatxad"</span>, </a>
<a class="sourceLine" id="cb11-10" title="10">                  <span class="st">"#ekacswt"</span>,  <span class="st">"#ewftxwd"</span>)</a>
<a class="sourceLine" id="cb11-11" title="11">       )</a></code></pre></div>
<p><code>prsp_stream</code> requires a <code>text</code> and <code>text_id column</code>. It wraps <code>prsp_score</code> and takes all its arguments. Let’s run the most basic version:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">text_sample <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">  </span><span class="kw"><a href="reference/prsp_stream.html">prsp_stream</a></span>(<span class="dt">text =</span> ctext,</a>
<a class="sourceLine" id="cb12-3" title="3">              <span class="dt">text_id =</span> textid,</a>
<a class="sourceLine" id="cb12-4" title="4">              <span class="dt">score_model =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOXICITY"</span>, <span class="st">"SEVERE_TOXICITY"</span>))</a></code></pre></div>
<pre><code>## Binding rows...</code></pre>
<pre><code>## # A tibble: 6 x 3
##   text_id  TOXICITY SEVERE_TOXICITY
##   &lt;chr&gt;       &lt;dbl&gt;           &lt;dbl&gt;
## 1 #efdcxct   0.955           0.794 
## 2 #ehfcsct   0.927           0.436 
## 3 #ekacxwt   0.0562          0.0224
## 4 #ewatxad   0.666           0.309 
## 5 #ekacswt   0.0694          0.0290
## 6 #ewftxwd   0.442           0.224</code></pre>
<p>You receive a <code>tibble</code> with your desired scorings including the <code>text_id</code> to match your score with your original dataframe.</p>
<p>Now, the problem is that sometimes the call might fail at some point. It is therefore suggested to set <code>safe_output = TRUE</code>. This will put the function into a <code><a href="https://purrr.tidyverse.org/reference/safely.html">purrr::safely</a></code> environment to ensure that your function will keep running even if you encounter errors.</p>
<p>Let’s try it out with a new dataset that contains text that the Perspective API can’t score</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">text_sample &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb15-2" title="2">       <span class="dt">ctext =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"You wrote this? Wow. This is dumb and childish, please go f**** yourself."</span>,</a>
<a class="sourceLine" id="cb15-3" title="3">                 <span class="st">"I don't know what to say about this but it's not good. The commenter is just an idiot"</span>,</a>
<a class="sourceLine" id="cb15-4" title="4">                 <span class="co">## empty string</span></a>
<a class="sourceLine" id="cb15-5" title="5">                 <span class="st">""</span>,</a>
<a class="sourceLine" id="cb15-6" title="6">                 <span class="st">"This goes even further!"</span>,</a>
<a class="sourceLine" id="cb15-7" title="7">                 <span class="st">"What the hell is going on?"</span>,</a>
<a class="sourceLine" id="cb15-8" title="8">                 <span class="st">"Please. I don't get it. Explain it again"</span>,</a>
<a class="sourceLine" id="cb15-9" title="9">                 <span class="co">## Gibberish</span></a>
<a class="sourceLine" id="cb15-10" title="10">                 <span class="st">"kdlfkmgkdfmgkfmg"</span>,</a>
<a class="sourceLine" id="cb15-11" title="11">                 <span class="st">"Annoying and irrelevant! I'd rather watch the paint drying on the wall!"</span>,</a>
<a class="sourceLine" id="cb15-12" title="12">                 <span class="co">## Gibberish</span></a>
<a class="sourceLine" id="cb15-13" title="13">                 <span class="st">"Hippi Hoppo"</span>),</a>
<a class="sourceLine" id="cb15-14" title="14">       <span class="dt">textid =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#efdcxct"</span>, <span class="st">"#ehfcsct"</span>, </a>
<a class="sourceLine" id="cb15-15" title="15">                  <span class="st">"#ekacxwt"</span>,  <span class="st">"#ewatxad"</span>, </a>
<a class="sourceLine" id="cb15-16" title="16">                  <span class="st">"#ekacswt"</span>,  <span class="st">"#ewftxwd"</span>, </a>
<a class="sourceLine" id="cb15-17" title="17">                  <span class="st">"#eeadswt"</span>,  <span class="st">"#enfhxed"</span>,</a>
<a class="sourceLine" id="cb15-18" title="18">                  <span class="st">"#efdmjd"</span>)</a>
<a class="sourceLine" id="cb15-19" title="19">       )</a></code></pre></div>
<p>And run the function with <code>safe_output = TRUE</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">text_sample <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">  </span><span class="kw"><a href="reference/prsp_stream.html">prsp_stream</a></span>(<span class="dt">text =</span> ctext,</a>
<a class="sourceLine" id="cb16-3" title="3">              <span class="dt">text_id =</span> textid,</a>
<a class="sourceLine" id="cb16-4" title="4">              <span class="dt">score_model =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOXICITY"</span>, <span class="st">"SEVERE_TOXICITY"</span>, <span class="st">"INSULT"</span>),</a>
<a class="sourceLine" id="cb16-5" title="5">              <span class="dt">safe_output =</span> T)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 5
##   text_id  error                           TOXICITY SEVERE_TOXICITY  INSULT
##   &lt;chr&gt;    &lt;chr&gt;                              &lt;dbl&gt;           &lt;dbl&gt;   &lt;dbl&gt;
## 1 #efdcxct No Error                          0.955           0.794   0.923 
## 2 #ehfcsct No Error                          0.927           0.436   0.947 
## 3 #ekacxwt "Error in .f(...): HTTP 400\nI~  NA              NA      NA     
## 4 #ewatxad No Error                          0.0562          0.0224  0.0315
## 5 #ekacswt No Error                          0.666           0.309   0.331 
## 6 #ewftxwd No Error                          0.0694          0.0290  0.0499
## 7 #eeadswt "Error in .f(...): HTTP 400\nI~  NA              NA      NA     
## 8 #enfhxed No Error                          0.442           0.224   0.321 
## 9 #efdmjd  "Error in .f(...): HTTP 400\nI~  NA              NA      NA</code></pre>
<p><code>safe_output = T</code> will also provide us with the error messages that occured so that we can check what went wrong!</p>
<p>Finally, there is one last argument: <code>verbose = TRUE</code>. Enable this argument and thanks to <a href="https://github.com/r-lib/crayon"><code>crayon</code></a> you will receive beautiful console output that guides you along the way, showing you errors and text scores as you go.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">text_sample <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">  </span><span class="kw"><a href="reference/prsp_stream.html">prsp_stream</a></span>(<span class="dt">text =</span> ctext,</a>
<a class="sourceLine" id="cb18-3" title="3">              <span class="dt">text_id =</span> textid,</a>
<a class="sourceLine" id="cb18-4" title="4">              <span class="dt">score_model =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TOXICITY"</span>, <span class="st">"SEVERE_TOXICITY"</span>),</a>
<a class="sourceLine" id="cb18-5" title="5">              <span class="dt">verbose =</span> T,</a>
<a class="sourceLine" id="cb18-6" title="6">              <span class="dt">safe_output =</span> T)</a></code></pre></div>
<p><img src="images/prsp_stream%20output.png"></p>
<p>Or the (not as pretty) output in Markdown</p>
<pre><code>## 11.11% [2019-05-12 02:41:55]: 1 out of 9 (11.11%)
## text_id: #efdcxct
##  0.96 TOXICITY
##  0.79 SEVERE_TOXICITY
## 
## 22.22% [2019-05-12 02:41:56]: 2 out of 9 (22.22%)
## text_id: #ehfcsct
##  0.93 TOXICITY
##  0.44 SEVERE_TOXICITY
## 
## 33.33% [2019-05-12 02:41:57]: 3 out of 9 (33.33%)
## text_id: #ekacxwt
## ERROR
## Error in .f(...): HTTP 400
## INVALID_ARGUMENT: Comment must be non-empty.
## NO SCORES
## 
## 44.44% [2019-05-12 02:41:58]: 4 out of 9 (44.44%)
## text_id: #ewatxad
##  0.06 TOXICITY
##  0.02 SEVERE_TOXICITY
## 
## 55.56% [2019-05-12 02:41:59]: 5 out of 9 (55.56%)
## text_id: #ekacswt
##  0.67 TOXICITY
##  0.31 SEVERE_TOXICITY
## 
## 66.67% [2019-05-12 02:42:01]: 6 out of 9 (66.67%)
## text_id: #ewftxwd
##  0.07 TOXICITY
##  0.03 SEVERE_TOXICITY
## 
## 77.78% [2019-05-12 02:42:02]: 7 out of 9 (77.78%)
## text_id: #eeadswt
## ERROR
## Error in .f(...): HTTP 400
## INVALID_ARGUMENT: Attribute SEVERE_TOXICITY does not support request languages: is
## NO SCORES
## 
## 88.89% [2019-05-12 02:42:03]: 8 out of 9 (88.89%)
## text_id: #enfhxed
##  0.44 TOXICITY
##  0.22 SEVERE_TOXICITY
## 
## 100.00% [2019-05-12 02:42:04]: 9 out of 9 (100.00%)
## text_id: #efdmjd
## ERROR
## Error in .f(...): HTTP 400
## INVALID_ARGUMENT: Attribute SEVERE_TOXICITY does not support request languages: ja-Latn
## NO SCORES</code></pre>
<pre><code>## # A tibble: 9 x 4
##   text_id  error                                   TOXICITY SEVERE_TOXICITY
##   &lt;chr&gt;    &lt;chr&gt;                                      &lt;dbl&gt;           &lt;dbl&gt;
## 1 #efdcxct No Error                                  0.955           0.794 
## 2 #ehfcsct No Error                                  0.927           0.436 
## 3 #ekacxwt "Error in .f(...): HTTP 400\nINVALID_A~  NA              NA     
## 4 #ewatxad No Error                                  0.0562          0.0224
## 5 #ekacswt No Error                                  0.666           0.309 
## 6 #ewftxwd No Error                                  0.0694          0.0290
## 7 #eeadswt "Error in .f(...): HTTP 400\nINVALID_A~  NA              NA     
## 8 #enfhxed No Error                                  0.442           0.224 
## 9 #efdmjd  "Error in .f(...): HTTP 400\nINVALID_A~  NA              NA</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/favstats/peRspective">https://​github.com/​favstats/​peRspective</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Fabio Votta <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/favstats/peRspective"><img src="https://travis-ci.org/favstats/peRspective.svg?branch=master"></a></li>
<li><a href="https://github.com/favstats/peRspective"><img src="https://img.shields.io/github/languages/code-size/favstats/peRspective.svg"></a></li>
<li><a href="https://github.com/favstats/peRspective/commits/master"><img src="https://img.shields.io/github/last-commit/favstats/peRspective.svg"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Fabio Votta.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
